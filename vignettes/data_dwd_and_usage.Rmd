---
title: "Basic usage of the climex package"
author: "Philipp MÃ¼ller"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Basic usage of the climex package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# About
This vignette provides an introduction into the basic usage of the
**climex** package: 

1. The download and formatting of all the station data provided by the
   German weather service (DWD) will be described (optional, but handy
   if you haven't build up your own data base yet).

# Downloading and formatting of the station data of the DWD

Since this package is intended to be used with climatic data, it comes
with a function to download and format all station data provided by
the [German weather service
(DWD)](http://www.dwd.de/DE/Home/home_node.html). I chose the daily
measured time series since a finer temporal resolution would not make
much sense in the context of extreme value analysis.

Before using the data please read the [terms of
use](ftp://ftp-cdc.dwd.de/pub/CDC/Terms_of_use.pdf) carefully.

This package, as well as its Shiny app, can be used without
downloading any data. So if you already have your own data base, feel
free to skip to the next chapter.

## Prerequisites 

By default the downloaded data as well as all the app's resources will
be stored in your home in folder called *~/R/climex/*. If you don't
like the name of the folder or have your own way of arranging your
local folder structure, fell free to change its path by adding the
following lines to your R configuration file *~/.Rprofile* in your
home.

```{r configuration, eval=FALSE}
## Replace PATH by the directory you want to store all files related to
## the climex app into.
options( climex.path = "PATH" )
```

## Downloading

In the second step open a new R konsole, load the climex package and
run the function downloading and formatting all the station data.

```{r downloading, eval = FALSE, cache = TRUE, dependson = "prerequisites"}
## Loading the climex package
library( climex )
## Download and format the station data. This may take a while.
download.data.dwd()
```

This will create a folder in `getOption( "climex.path" )` called
**download_dwd** containing the mirrored content of the daily measured
station data from the DWD's FTP server. Those .zip files will be
extracted, parsed and converted to the
[xts](https://CRAN.R-project.org/package=xts) format one after
another. The parsing takes some time and can last for several minutes
depending on your machine's specifications.

To avoid saving the raw data the argument *save.downloads* can be set
to FALSE. But it is recommended to keep the default value of TRUE
since the function will compare the time stamps of the files on the
FTP server against the ones of the local copies. Running this function
another time will thus update your existing data base without
downloading all the content again.

By default three different types of data will be extracted: the daily
maximal and minimal temperature and the daily precipitation. Using the
*data.type* argument one can obtain a variety of additional
information from the DWD data base. There are several stations with
missing data or for which specific types of measurements are not
available at all. In the original time series those were set to -999
but during the formatting they are replaced by NA to avoid numerical
artifacts. Please be aware that these steps will use the *mclapply*
function of the
[parallel](https://stat.ethz.ch/R-manual/R-devel/library/parallel/doc/parallel.pdf)
package starting threads on all your machine's cores to enhance the
speed of the import.

After parsing the data will be saved as lists of objects of the class
**xts** and written to the *climex.path/dwd_downloads* folder in R's
binary format .RData.

In addition there is the *csv.export* option exporting the lists of
xts data to .csv files which can be imported into any other
application. For each chosen data source in the *data.type* character
vector a new folder will be created containing the data of each single
station in a different file.

## Loading the data

Since the data will be stored, you do not have to repeat this step every time you want to load the data.

```{r dwd-loading, eval = FALSE, cache = TRUE, dependson = "downloading"}
source.data()
```
If the *pick.default* option is set to TRUE it will just look for the
default station data (containing the maximum and minimum daily
temperature as well as the daily precipitation). If the option is set
to FALSE an interactive choice we be prompted instead.
This will print all existing .RData files in the
*climex.path/dwd_downloads* folder and let the user choose which one
to import. As an alternative one of course can just use the plain
*load()* function from the **base** package.
